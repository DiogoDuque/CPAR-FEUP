# CPAR

## Compiling and Executing

### C
```
gcc matrix.c -Wall -O3 -lm -o cMatrix /opt/papi/lib/libpapi.a
# or
gcc matrix.c -Wall -O3 -fopenmp -lm -o cMatrix /opt/papi/lib/libpapi.a

./cMatrix v1
# or
./cMatrix v2
```
### Java
```
javac Matrix.java
java Matrix
```

### C#
```
mcs Matrix.cs
mono Matrix.exe
```

### Python 2.7
```
python matrix.py
```


## Running the tools

### PAPI
Checking available flags in my system:
```
/opt/papi/bin/papi_avail -a
```

### TipTop
```
/opt/tiptop/bin/tiptop
```


## Running Times

### Matrix-multiplying _naive_ algorithm

|Languages | 500 | 1000 | 1500 | 2000 | 2500 | 3000 |
|:--------:|-----|------|------|------|------|------|
| C (v1)   |0.1s | 1.2s | 5.5s | 11s  | 21s  | 35s  |
| C (v2)   |0.1s | 0.4s | 1.4s | 3.2s | 6.4s | 11s  |
| Java     |0.2s | 2.5s | 11s  | 27s  | 53s  |1m34s |
| C#       |0.5s |  6s  | 54s  |2m44s |2m34s |9m48s |
| Python   | 13s |1m47s |6m15s |14m07s|28m27s|48m05s|

### In-depth C performance analysis

#### _Naive_ algorithm
|Matrix size|Total DCM|FLOP|FLOPS|DCM/FLOP|Time|
|---|---|---|---|---|---|
|500x500|73694933|2.5e8|2079918799|0.295|0.1s|
|1000x1000|1206505880|2e9|1606411509|0.603|1.2s|
|1500x1500|4405047596|6.75e9|1219365915|0.653|5.5s|
|2000x2000|13771367675|1.6e10|1490302415|0.861|11s|
|2500x2500|25933196711|3.125e10|1471864081|0.83|21s|
|3000x3000|46882665625|5.4e10|1561888576|0.868|35s|
|---|---|---|---|---|---|
| 5000x5000 |318969184858|2.5e11|1137433268|1.276|3m20s|
| 6000x6000 |565648659162|4.32e11|1083321436|1.309|6m39s|
| 7000x7000 |942578314821|6.86e11|983424844|1.374|13m8s|
| 8000x8000 |1234374407052|1.024e12|930983762|1.205|1100s|
| 9000x9000 |1985673913825|1.458e12|958722128|1.362|1521s|
|10000x10000|2605879130663|2e12|1019245200|1.303|1962s|

#### Enhanced algorithm
|Matrix size| Total DCM | FLOP | FLOPS |DCM/FLOP| Time |
|---|---|---|---|---|---|
|  500x500  |24109594|2.5e8|4703845864|0.096|0.05s|
| 1000x1000 |189951179|2e9|4904870045|0.095|0.4s|
| 1500x1500 |627212174|6.75e9|4970607143|0.093|1.4s|
| 2000x2000 |1480856000|1.6e10|5058683894|0.093|3.2s|
| 2500x2500 |2905929810|3.125e10|4866208843|0.093|6.4s|
| 3000x3000 |5046291800|5.4e10|4778139903|0.093|11s|
|---|---|---|---|---|---|
| 5000x5000 |28518856494|2.5e11|6266106871|0.114|40s|
| 6000x6000 |51004075092|4.32e11|5874674827|0.118|1m14s|
| 7000x7000 |79630510230|6.86e11|6090834226|0.116|1m53s|
| 8000x8000 |115876399663|1.024e12|6361540827|0.113|2m41s|
| 9000x9000 |168065881411|1.458e12|6308541824|0.115|3m51s|
|10000x10000|231109186127|2e12|6232400635|0.116|5m21s|

### Linear vs parallel

#### Naive algorithm
|Matrix size\Nr of Threads|1|2|3|4|5|6|7|8|
|:---:|---:|---:|---:|---:|---:|---:|---:|---:|
|  500x500  |0.24s|0.13s|0.11s|0.09s|0.11s|0.12s|0.12s|0.13s|
| 1000x1000 |2.0s|1.2s|0.88s|2.4s|0.79s|0.79s|1.1s|0.86s|
| 1500x1500 |7.8s|4.2s|2.7s|2.7s|3.3s|3.1s|2.9s|3.2s|
| 2000x2000 |16.2s|9.7s|7.8s|7.0s|7.8s|6.8s|7.3s|6.5s|
| 2500x2500 |34.1s|22.0s|16.7s|13.9s|16.7s|16.5s|17.5s|17.4s|
| 3000x3000 |65s|32s|28s|24s|26s|28s|28s|27s|



#### Enhanced algorithm
|Matrix size\Nr of Threads|1|2|3|4|5|6|7|8|
|:---:|---:|---:|---:|---:|---:|---:|---:|---:|
|  500x500  |0.12s|0.06s|0.05s|0.04s|0.03s|0.04s|0.03s|0.03s|
| 1000x1000 |0.40s|0.48s|0.34s|0.29s|0.26s|0.26s|0.25s|0.24s|
| 1500x1500 |1.3s|1.6s|1.2s|0.94s|0.86s|0.80s|0.79s|0.80s|
| 2000x2000 |2.9s|3.7s|3.6s|2.6s|2.3s|2.2s|2s|2.2s|
| 2500x2500 |5.9s|7.2s|5.5s|5.7s|5.3s|4.5s|4.6s|4.4s|
| 3000x3000 |9.9s|12.5s|9.6s|8.2s|8.3s|8.7s|8.2s|7.7s|
